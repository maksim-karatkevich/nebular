(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{SM1g:function(t,e,n){"use strict";n.r(e);var r=n("Valr"),o=n("QJY3"),i=n("cUzu"),c=n("0AKQ"),a=n("F4EV"),s=n("n81q"),u=n("15JJ"),l=n("BDhN"),p=n("0ICW"),h=n("TYT/"),f=function(){function t(t,e){this.injector=t,this.filter=e}return t.prototype.intercept=function(t,e){var n=this;return this.filter(t)?e.handle(t):this.authService.isAuthenticatedOrRefresh().pipe(Object(u.a)((function(r){return r?n.authService.getToken().pipe(Object(u.a)((function(n){var r="Bearer "+n.getValue();return t=t.clone({setHeaders:{Authorization:r}}),e.handle(t)}))):e.handle(t)})))},Object.defineProperty(t.prototype,"authService",{get:function(){return this.injector.get(l.a)},enumerable:!0,configurable:!0}),t.\u0275fac=function(e){return new(e||t)(h.ic(h.s),h.ic(p.e))},t.\u0275prov=h.Qb({token:t,factory:t.\u0275fac}),t}(),b=n("Abgx"),d=n("6y2k"),g=n("++eV"),y=n("4pP6"),v=n("X/Iy"),m=n("89WS"),w=function(){return function(){}}(),R=new h.r("Nebular Security Options"),k=function(t){return Object.assign({},t)},O=function(t){return Object.assign([],t)},S=function(t){var e=t.parent;return delete t.parent,e},C=function(){function t(t){void 0===t&&(t={}),this.settings=t,this.state={},t.accessControl&&this.setAccessControl(t.accessControl)}return t.prototype.setAccessControl=function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e],o=r[0],i=k(r[1]),c=S(i);this.register(o,c,i)}},t.prototype.register=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n={}),this.validateRole(t),this.state[t]={parent:e};for(var r=0,o=Object.entries(n);r<o.length;r++){var i=o[r],c=i[1];this.allow(t,i[0],O("string"==typeof c?[c]:c))}},t.prototype.allow=function(t,e,n){this.validateRole(t),this.getRole(t)||this.register(t,null,{}),n="string"==typeof n?[n]:n;var r=O(this.getRoleResources(t,e));r=r.concat(n),this.state[t][e]=r.filter((function(t,e){return r.indexOf(t)===e}))},t.prototype.can=function(t,e,n){return this.validateResource(n),this.getRoleParent(t)&&this.can(this.getRoleParent(t),e,n)||this.exactCan(t,e,n)},t.prototype.getRole=function(t){return this.state[t]},t.prototype.validateRole=function(t){if(!t)throw new Error("NbAclService: role name cannot be empty")},t.prototype.validateResource=function(e){if(!e||[t.ANY_RESOURCE].includes(e))throw new Error("NbAclService: cannot use empty or bulk '*' resource placeholder with 'can' method")},t.prototype.exactCan=function(e,n,r){var o=this.getRoleResources(e,n);return o.includes(r)||o.includes(t.ANY_RESOURCE)},t.prototype.getRoleResources=function(t,e){return this.getRoleAbilities(t)[e]||[]},t.prototype.getRoleAbilities=function(t){var e=k(this.state[t]||{});return S(k(this.state[t]||{})),e},t.prototype.getRoleParent=function(t){return this.state[t]?this.state[t].parent:null},t.ANY_RESOURCE="*",t.\u0275fac=function(e){return new(e||t)(h.ic(R,8))},t.\u0275prov=h.Qb({token:t,factory:t.\u0275fac}),t}(),P=n("67Y/"),A=function(){function t(t,e){this.roleProvider=t,this.acl=e}return t.prototype.isGranted=function(t,e){var n=this;return this.roleProvider.getRole().pipe(Object(P.a)((function(t){return Array.isArray(t)?t:[t]})),Object(P.a)((function(r){return r.some((function(r){return n.acl.can(r,t,e)}))})))},t.\u0275fac=function(e){return new(e||t)(h.ic(w),h.ic(C))},t.\u0275prov=h.Qb({token:t,factory:t.\u0275fac}),t}(),j=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:R,useValue:e},C,A]}},t.\u0275mod=h.Sb({type:t}),t.\u0275inj=h.Rb({factory:function(e){return new(e||t)},imports:[[r.c]]}),t}(),Z=n("DUip"),V=function(){function t(){}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=h.Ob({type:t,selectors:[["nb-playground-auth"]],decls:1,vars:0,template:function(t,e){1&t&&h.Vb(0,"router-outlet")},directives:[Z.h],encapsulation:2}),t}(),I=n("2Az5"),E=n("DYSn"),G=n("9S34"),N=n("9XlZ"),U=n("Lu/0"),T=n("8qs0"),D=n("vuB0"),Y=n("S+eJ"),F=n("ny24"),$=n("K9Ia"),Q=function(){function t(t,e,n){this.templateRef=t,this.viewContainer=e,this.accessChecker=n,this.destroy$=new $.a,this.hasView=!1}return Object.defineProperty(t.prototype,"nbIsGranted",{set:function(t){var e=this;this.accessChecker.isGranted(t[0],t[1]).pipe(Object(F.a)(this.destroy$)).subscribe((function(t){t&&!e.hasView?(e.viewContainer.createEmbeddedView(e.templateRef),e.hasView=!0):!t&&e.hasView&&(e.viewContainer.clear(),e.hasView=!1)}))},enumerable:!0,configurable:!0}),t.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},t.\u0275fac=function(e){return new(e||t)(h.Ub(h.N),h.Ub(h.S),h.Ub(A))},t.\u0275dir=h.Pb({type:t,selectors:[["","nbIsGranted",""]],inputs:{nbIsGranted:"nbIsGranted"}}),t}();function _(t,e){1&t&&(h.ac(0,"button"),h.Pc(1,"Post Comment"),h.Zb())}function q(t,e){1&t&&(h.ac(0,"button"),h.Pc(1,"Post Comment"),h.Zb())}var x=function(){return["create","comments"]},J=function(){function t(t){this.accessChecker=t}return t.\u0275fac=function(e){return new(e||t)(h.Ub(A))},t.\u0275cmp=h.Ob({type:t,selectors:[["nb-actions-test"]],decls:13,vars:5,consts:[[4,"ngIf"],[4,"nbIsGranted"]],template:function(t,e){1&t&&(h.ac(0,"nb-layout"),h.ac(1,"nb-layout-column"),h.ac(2,"nb-card"),h.ac(3,"nb-card-header"),h.Pc(4,"Service usage"),h.Zb(),h.ac(5,"nb-card-body"),h.Nc(6,_,2,0,"button",0),h.rc(7,"async"),h.Zb(),h.Zb(),h.ac(8,"nb-card"),h.ac(9,"nb-card-header"),h.Pc(10,"Directive usage"),h.Zb(),h.ac(11,"nb-card-body"),h.Nc(12,q,2,0,"button",1),h.Zb(),h.Zb(),h.Zb(),h.Zb()),2&t&&(h.Gb(6),h.wc("ngIf",h.sc(7,2,e.accessChecker.isGranted("create","comments"))),h.Gb(6),h.wc("nbIsGranted",h.zc(4,x)))},directives:[D.b,D.a,Y.b,Y.d,Y.a,r.o,Q],pipes:[r.b],encapsulation:2}),t}(),M=n("xMyE"),W=function(){function t(t,e){this.authService=t,this.router=e}return t.prototype.canActivate=function(){var t=this;return this.authService.isAuthenticated().pipe(Object(M.a)((function(e){e||t.router.navigate(["auth/login"])})))},t.\u0275fac=function(e){return new(e||t)(h.ic(l.a),h.ic(Z.c))},t.\u0275prov=h.Qb({token:t,factory:t.\u0275fac}),t}(),z=n("F/XL"),B=n("vubp"),X=n("9Z1F"),H=n("iVvT"),K=n("jXul");function L(t,e){if(1&t&&(h.ac(0,"nb-list-item"),h.Pc(1),h.Zb()),2&t){var n=e.$implicit;h.Gb(1),h.Tc(" ",n.region,", ",n.name," (",n.year,") ")}}function tt(t,e){if(1&t&&(h.ac(0,"nb-card"),h.ac(1,"nb-card-header"),h.Pc(2," Alain'wines "),h.Zb(),h.ac(3,"nb-list"),h.Nc(4,L,2,3,"nb-list-item",2),h.rc(5,"async"),h.Zb(),h.Zb()),2&t){var n=h.qc();h.Gb(4),h.wc("ngForOf",h.sc(5,1,n.wines$))}}var et=[{path:"",component:V,children:[{path:"",component:I.a,children:[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:E.a},{path:"register",component:G.a},{path:"logout",component:N.a},{path:"request-password",component:U.a},{path:"reset-password",component:T.a}]}]},{path:"acl/acl-test.component",component:J},{path:"auth-guard.service",canActivate:[W],component:V},{path:"api-calls.component",canActivate:[W],component:function(){function t(t,e,n,r){var o=this;void 0===r&&(r={}),this.authService=t,this.http=e,this.router=n,this.options=r,this.redirectDelay=0,this.strategy="",this.redirectDelay=this.getConfigValue("forms.logout.redirectDelay"),this.strategy=this.getConfigValue("forms.logout.strategy"),this.authService.onTokenChange().subscribe((function(t){o.token=null,t&&t.isValid()&&(o.token=t)}))}return t.prototype.logout=function(){var t=this;this.authService.logout(this.strategy).pipe(Object(B.a)(this.redirectDelay)).subscribe((function(e){return t.router.navigate(["/auth/login"])}))},t.prototype.loadWines=function(){var t=this;this.wines$=this.http.get("http://localhost:4400/api/wines").pipe(Object(X.a)((function(e){return e instanceof i.d&&401===e.status&&t.router.navigate(["/auth/login"]),Object(z.a)([])})))},t.prototype.getConfigValue=function(t){return Object(H.b)(this.options,t,null)},t.\u0275fac=function(e){return new(e||t)(h.Ub(l.a),h.Ub(i.b),h.Ub(Z.c),h.Ub(p.b))},t.\u0275cmp=h.Ob({type:t,selectors:[["nb-playground-api-calls"]],decls:15,vars:3,consts:[["nbButton","","status","primary",3,"click"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(t,e){if(1&t&&(h.Vb(0,"router-outlet"),h.ac(1,"nb-layout"),h.ac(2,"nb-layout-column"),h.ac(3,"nb-card"),h.ac(4,"nb-card-body"),h.ac(5,"h2"),h.Pc(6,"You are authenticated"),h.Zb(),h.ac(7,"p"),h.Pc(8,"You can call the secured API"),h.Zb(),h.ac(9,"button",0),h.mc("click",(function(){return e.loadWines()})),h.Pc(10,"Call API"),h.Zb(),h.ac(11,"button",0),h.mc("click",(function(){return e.logout()})),h.Pc(12,"Sign out"),h.Zb(),h.Zb(),h.Zb(),h.Nc(13,tt,6,3,"nb-card",1),h.rc(14,"async"),h.Zb(),h.Zb()),2&t){var n,r=null==(n=h.sc(14,1,e.wines$))?null:n.length;h.Gb(13),h.wc("ngIf",r)}},directives:[Z.h,D.b,D.a,Y.b,Y.a,r.o,Y.d,K.a,r.n,K.b],pipes:[r.b],encapsulation:2}),t}()}],nt=function(){function t(){}return t.\u0275mod=h.Sb({type:t}),t.\u0275inj=h.Rb({factory:function(e){return new(e||t)},imports:[[Z.g.forChild(et)],Z.g]}),t}(),rt=function(){function t(t){this.authService=t}return t.prototype.getRole=function(){return this.authService.onTokenChange().pipe(Object(P.a)((function(t){return t instanceof y.b&&t.isValid()?t.getPayload().role:"guest"})))},t.\u0275fac=function(e){return new(e||t)(h.ic(l.a))},t.\u0275prov=h.Qb({token:t,factory:t.\u0275fac}),t}();function ot(t){return["http://localhost:4400/api/auth/","http://other.url/with/no/token/injected/"].some((function(e){return t.url.includes(e)}))}n.d(e,"filterInterceptorRequest",(function(){return ot})),n.d(e,"AuthPlaygroundModule",(function(){return it}));var it=function(){function t(){}return t.\u0275mod=h.Sb({type:t}),t.\u0275inj=h.Rb({factory:function(e){return new(e||t)},providers:[W,{provide:i.a,useClass:f,multi:!0},{provide:p.e,useValue:ot},{provide:w,useClass:rt}],imports:[[r.c,o.g,i.c,nt,c.a,a.a,s.a,b.a.forRoot({forms:{login:{strategy:"password",redirectDelay:1e3,socialLinks:[{url:"https://github.com/akveo",target:"_blank",title:"GitHub"},{url:"https://www.facebook.com/akveo",target:"_blank",icon:"home-outline"},{url:"https://www.facebook.com/akveo",target:"_blank",title:"Twitter"}]}},strategies:[d.a.setup({name:"dummy",alwaysFail:!0,delay:1e3}),g.a.setup({name:"email",token:{class:y.b},baseEndpoint:"http://localhost:4400/api/auth/",logout:{redirect:{success:"/auth/login",failure:"/auth/login"}},requestPass:{redirect:{success:"/auth/reset-password"}},resetPass:{redirect:{success:"/auth/login"}},errors:{key:"data.errors"}}),v.a.setup({name:"password",clientId:"test",clientSecret:"secret",baseEndpoint:"http://localhost:4400/api/auth/",token:{endpoint:"token",grantType:m.b.PASSWORD,class:y.d},refresh:{endpoint:"refresh-token",grantType:m.b.REFRESH_TOKEN}})]}),j.forRoot({accessControl:{guest:{view:["news","comments"]},user:{parent:"guest",create:"comments"},moderator:{parent:"user",create:"news",remove:"*"}}})]]}),t}()}}]);